# タスク完了時のチェックリスト

## コード変更後の必須手順

タスクを完了したら、以下の手順を**必ず**実行してください。

### 1. 型チェック

```bash
cd /Users/anno/Downloads/shokimaru/shokimaru-web
npx tsc --noEmit
```

**目的**: TypeScriptの型エラーを検出
**対応**: すべての型エラーを修正してから次へ進む

### 2. リンティング

```bash
npm run lint
```

**目的**: コード品質とスタイルの問題を検出
**対応**: 
- エラーは必ず修正
- 警告も可能な限り修正
- ESLintルールに従う

### 3. ビルドテスト

```bash
npm run build
```

**目的**: プロダクションビルドが成功することを確認
**対応**: 
- ビルドエラーがある場合は修正
- 警告も確認して対処
- ビルド成功を確認してから次へ

### 4. 開発サーバーでの動作確認（オプション）

```bash
npm run dev
```

**目的**: 変更が期待通りに動作することを確認
**対応**:
- ブラウザで http://localhost:3000 にアクセス
- 変更したページ/機能を手動テスト
- エラーがないことを確認

## Git コミット前のチェックリスト

### 5. 変更内容の確認

```bash
git status
git diff
```

**確認事項**:
- 意図した変更のみがステージングされているか
- 不要なファイルが含まれていないか
- デバッグコードやコンソールログが残っていないか
- 環境変数やシークレットが含まれていないか

### 6. ステージングとコミット

```bash
git add .
git commit -m "明確なコミットメッセージ"
```

**コミットメッセージのガイドライン**:
- 日本語または英語で明確に
- 何を変更したか、なぜ変更したかを説明
- 例: 
  - "釣果一覧ページに月齢フィルタを追加"
  - "Fix: 画像アップロード時のエラーハンドリング改善"
  - "feat: Add moon phase display to results page"

### 7. プッシュ

```bash
git push origin main
# または
git push origin <branch-name>
```

**注意**: mainブランチへのプッシュは自動的にVercelデプロイをトリガーします

## Supabase関連の変更時

### データベーススキーマ変更時

1. **マイグレーション作成**
```bash
npx supabase migration new <migration_name>
```

2. **マイグレーション編集**
- `supabase/migrations/` 内のマイグレーションファイルを編集
- SQLを記述

3. **マイグレーション適用**
```bash
npx supabase db push
```

4. **型定義生成**
```bash
npx supabase gen types typescript --local > src/types/database.types.ts
```

5. **型チェック**
```bash
npx tsc --noEmit
```

## デプロイ後の確認

### Vercel デプロイ後

1. **デプロイ状況確認**
- Vercelダッシュボードで確認
- デプロイログをチェック

2. **本番環境での動作確認**
- 本番URLにアクセス
- 変更した機能をテスト
- エラーログを確認

3. **問題があった場合**
- ロールバックまたは修正コミット
- 迅速に対応

## 避けるべきこと

### ❌ やってはいけないこと

1. **型エラーを残したままコミット**
2. **ビルドエラーがある状態でプッシュ**
3. **テストせずにプッシュ**
4. **機密情報（APIキー、パスワード）をコミット**
5. **意図しないファイルをコミット**
6. **不明瞭なコミットメッセージ**

### ✅ 推奨事項

1. **小さな変更を頻繁にコミット**
2. **各コミットは単一の目的に集中**
3. **コミット前に必ずレビュー**
4. **型チェックとリントを習慣化**
5. **本番環境でのテストを忘れない**

## トラブルシューティング

### ビルドエラーが出た場合

1. エラーメッセージを詳細に読む
2. 該当ファイルの変更を確認
3. 型定義やインポートを確認
4. 必要に応じて依存関係を再インストール

### リントエラーが出た場合

1. エラーメッセージの指示に従う
2. 自動修正可能なら `npm run lint -- --fix` を実行
3. コーディング規約に従って手動修正

### 型エラーが出た場合

1. エラー箇所の型定義を確認
2. Supabase型定義が最新か確認
3. 型アサーションは最小限に
4. 適切な型を明示的に指定

## まとめ

タスク完了時の基本フロー:

```bash
# 1. 型チェック
npx tsc --noEmit

# 2. リンティング
npm run lint

# 3. ビルド
npm run build

# 4. Git確認
git status
git diff

# 5. コミット
git add .
git commit -m "コミットメッセージ"

# 6. プッシュ
git push origin main
```

この手順を守ることで、品質の高いコードを維持し、本番環境での問題を最小限に抑えることができます。
